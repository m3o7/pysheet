<link rel="import" href="/static/js/bower_components/polymer/polymer.html">
<link rel="import" href="/static/js/bower_components/polymer-ajax/polymer-ajax.html">

<polymer-element name="pys-table" attributes="name project visible data errorMsg showError">
    
    <template>

        <style type="text/css">
            .back {
                background-color: #FFFFFF;
                height: 50px;
                width: 200px;
                line-height: 50px;
                color: #26AFD8;
                text-align: center;
            }

            table {
                margin: auto;
            }

            table, th, td{
                border-collapse:collapse;
                border: 1px solid #fff;
            }

            th, td {
                min-width: 100px;
            }

            .table-box {
                width: 100%;
            }

        </style>

        <template if="{{visible}}">
            <div class="back" on-click="{{showMenu}}">back to menu</div>
            <polymer-ajax   id="tableData" 
                            url="/project/{{project}}/{{name}}/run" 
                            response="{{data}}" 
                            auto 
                            handleAs="json">

            <template if="{{showError}}">
                <div>{{errorMsg}}</div>
            </template>
            <div class="table-box">
                <table>
                    <template repeat="{{ row in data }}">
                    <tr>
                        <template repeat="{{ field in row }}">
                        <td>{{field}}</td>
                        </template>
                    </tr>
                    </template>
                </table>
            </div>
        </template>
    </template>

    <script>
        Polymer('pys-table', {
            showError: false,

            ready: function(){
                var me = this;
                this.addEventListener('polymer-error', function(){
                    me.data = [];
                    me.errorMsg = 'loading error';
                    me.showError = true;
                });
                this.addEventListener('polymer-response', function(){
                    me.showError = false;
                });
            },

            dataChanged: function(){
            },

            showMenu: function (event, detail, sender) {
                // open the menu again
                this.fire('open-menu');
            },
        });
    </script>

</polymer-element>
